<script type="text/javascript">
	let allFiles = [{{ page.files }}];
	let gallery = document.querySelector("#gallery")

	for(let i=0; i<allFiles.length; i++){
		if(allFiles[i].includes(".mov")||allFiles[i].includes(".mp4")){
			let vid = document.createElement("video");
			vid.dataset.src="../assets/images/{{ page.project }}/" + allFiles[i];
			vid.classList.add("media");
			vid.controls=false;
			vid.muted=true;
			vid.autoplay=true;
			vid.loop=true;
			gallery.append(vid)
		} else{
			let img = document.createElement("img");
			img.dataset.src = "../assets/images/{{ page.project }}/"+ allFiles[i];
			img.classList.add("media");
			gallery.append(img)
		}

	}

	const images = document.querySelectorAll("[data-src]");

	
	const imgOptions = {
		threshold: 0,
		rootMargin: "100px"
	};

	const imgObserver = new IntersectionObserver((entries, 
	imgObserver) => {
		entries.forEach(entry => {
			if (entry.isIntersecting) {
				preloadImage(entry.target);
				imgObserver.unobserve(entry.target);
			}
		})
}, imgOptions);

images.forEach(image => {
	imgObserver.observe(image);
});


function preloadImage(img) {
	const src = img.getAttribute("data-src");
	if(!src){
		return;
	}
	img.src = src;

}

</script>
